/*! skrollr-stylesheets 0.1.0 (2014-04-17) | Alexander Prinzhorn - https://github.com/Prinzhorn/skrollr-stylesheets | Free to use under terms of MIT license */
define(["skrollr"],function(a){"use strict";function b(){for(var a,b=document.body.querySelectorAll("*"),c=[],d=0,e=b.length;e>d;d++){a=b[d];for(var f=0;f<a.attributes.length;f++){var g=a.attributes[f];/^data-\-?[0-9]+$/.test(g.name)&&c.push(g.name)}for(f=0;f<c.length;f++)a.removeAttribute(c[f])}}function c(a,b){for(var c,d,e,f,g,h,i,j=[],k={},l="data-"+o+"-"+b,m=0,n=a.length;n>m;m++)if(c=a[m],"1"==b.charAt(m)){j=j.concat(c.selectors);for(var p in c.animations)c.animations.hasOwnProperty(p)&&(k[p]=c.animations[p])}for(var q=0,r=j.length;r>q;q++)if(d=j[q],e=document.querySelectorAll(d[0])){h=k[d[1]];for(var s=0,t=e.length;t>s;s++){f=e[s],g=JSON.parse(f.getAttribute(l)||"{}");for(i in h)";"!=h[i].charAt(h[i].length-1)&&(h[i]+=";"),g[i]=g[i]?h[i]+g[i]:h[i];f.setAttribute(l,JSON.stringify(g))}}}function d(a){var b,c="";if(!matchMedia)return e("1",a.length);for(var d=0,f=a.length;f>d;d++)b=a[d],c=c.concat(!b.media||matchMedia(b.media).matches?"1":"0");return c}function e(a,b){var c="";if(1>b)return c;for(;b>0;)1&b&&(c+=a),b>>=1,a+=a;return c}function f(a){a=a.trim();for(var b=(";"==a.charAt(a.length-1)?a.substring(0,a.length-1):a).split(";"),c=[],d=0,e=b.length;e>d;d++)c.push(b[d].split(":")[0]);return c}function g(){v(!0)}var h,i,j,k=[],l=30,m="",n={},o="ss",p=/@-skrollr-keyframes\s+([\w-]+)/g,q=/\s*\{\s*((?:[^{]+\{[^}]*\}\s*)+?)\s*\}/g,r=/([\w\-]+)\s*\{([^}]+)\}/g,s=/-skrollr-animation-name\s*:\s*([\w-]+)/g,t=function(a){var b=new XMLHttpRequest;try{b.open("GET",a,!1),b.send(null)}catch(c){window.XDomainRequest&&(b=new XDomainRequest,b.open("GET",a,!1),b.send(null))}return b.responseText},u=function(a,b){j=b;for(var c=0,d=a.length;d>c;c++){var e,f=a[c];if("LINK"===f.tagName){if(null===f.getAttribute("data-skrollr-stylesheet"))continue;e=t(f.href)}else e=f.textContent||f.innerText||f.innerHTML;e&&k.push({content:e,media:f.getAttribute("media"),animations:{},selectors:[]})}k.reverse();for(var g=0;g<k.length;g++)e=k[g].content,w(e,k[g].animations),x(e,k[g].selectors);v(!1)},v=function(a){var e,f=(new Date).getTime();return a&&h&&l>f-h?(window.clearTimeout(i),void(i=window.setTimeout(v,l))):(h=f,e=d(k),void(e!==m&&(b(),n[e]||(c(k,e),n[e]=!0),y(e),j.refresh(),m=e)))},w=function(a,b){p.lastIndex=0;for(var c,d,e,f;null!==(c=p.exec(a));)for(q.lastIndex=p.lastIndex,d=q.exec(a),r.lastIndex=0,f=b[c[1]]={};null!==(e=r.exec(d[1]));)f[e[1]]=e[2].replace(/[\n\r\t]/g,"")},x=function(a,b){s.lastIndex=0;for(var c,d,e;null!==(c=s.exec(a));){for(e=s.lastIndex;e--&&"{"!==a.charAt(e););for(d=e;d--&&"}"!==a.charAt(d-1););b.push([a.substring(d,e).replace(/[\n\r\t]/g,""),c[1]])}},y=function(b){for(var c,d="data-"+o+"-"+b,e="data-"+o+"-"+m,g=document.querySelectorAll("["+d+"], ["+e+"]"),h=function(b){a.setStyle(c,b,"")},i=function(a){return a.replace(/\[.*\]/,"")},j=0,k=g.length;k>j;j++){c=g[j];var l=JSON.parse(c.getAttribute(d))||{};for(var n in l)c.setAttribute("data-"+n,l[n]);var p=JSON.parse(c.getAttribute(e))||{};for(var q in p)f(p[q]).map(i).forEach(h)}};return{init:function(b){u(document.querySelectorAll("link, style"),b||a.get()||a.init()),window.addEventListener?window.addEventListener("resize",g,!1):window.attachEvent&&window.attachEvent("onresize",g)},registerKeyframeChange:function(){var a=d(k);a===m&&(y(a),j.refresh())}}});